"use strict";var S7Framework=(function($,undefined){var version="0.1.23";var BOOL=0,UINT=1,INT=2,REAL=3,LREAL=4,STRING=5,DATE_AND_TIME=10;var DEBUG=!1;var initialized=!1;var initializedRetVal=!1;var _plcType=null;var diagElements={};var diagInitialized=!1;var urlAlarmTable="";var alarmElements={};var alarmInitialized=!1;var MultiUseToken="";var firstRetVal;var prevState;var prevTitle;var prevUrl;function htmlDecodeEntities(value){return(typeof value==='undefined')?'':$('<div/>').html(value).text()}
function convString(DATA,LEN,TYPE,STR,ERROR){var i=0,j=0;var values=[];DATA=htmlDecodeEntities(DATA);DATA=DATA.replace(/"|'|\s/g,"")
LEN=LEN.replace(/"|'|\s/g,"");TYPE=TYPE.replace(/"|'|\s/g,"");STR=htmlDecodeEntities(STR);STR=STR.replace(/"|'|\s/g,"");console.assert(!DEBUG,"CONV Items=",DATA,LEN,TYPE,STR);LEN=LEN.split(";");TYPE=TYPE.split(";");STR=STR.split(";");while(i<LEN.length){LEN[i]=parseInt(LEN[i],10);TYPE[i]=parseInt(TYPE[i],10);i++}
i=0;while((j<DATA.length)&&(i<LEN.length)){values[i]=(TYPE[i]!=5)?convAsciiToHex(DATA.substr(j,LEN[i]),LEN[i]):DATA.substr(j,LEN[i]);console.assert(!DEBUG,"Decode string part =",i,values[i],TYPE[i]);switch(TYPE[i]){case 0:values[i]=HexToBool(values[i]);break;case 1:case 2:values[i]=HexToInt(values[i],TYPE[i],LEN[i]);break;case 3:values[i]=HexToReal(values[i]);break;case 4:values[i]=HexToLongFloat(DATA.substr(j,LEN[i]));break;case 5:break;case 10:values[i]=HexToDateAndTime(DATA.substr(j,LEN[i]));break;default:console.error("Type input failure in function -convString()- @ index"+i+"\n"+ERROR);break}
j+=LEN[i];i++}
for(var index in STR){values[i]=STR[index];i++}
return values}
function convAsciiToHex(ASCII,N){var result=0;var zeichen=0;for(var i=0;i<N;i++){if(('0'<=ASCII[i])&&(ASCII[i]<='9')){zeichen=ASCII.charCodeAt(i)-48}
else if(('A'<=ASCII[i])&&(ASCII[i]<='F')){zeichen=ASCII.charCodeAt(i)-55}
else if(('a'<=ASCII[i])&&(ASCII[i]<='f')){zeichen=ASCII.charCodeAt(i)-87}
else{console.error("Character Failure = -"+ASCII+"-, "+N);return Math.NaN}
result+=zeichen*Math.pow(16,N-1-i)}
return result}
function HexToBool(t_Bool){return(t_Bool==="1"||t_Bool===1||t_Bool===!0)?!0:!1}
function HexToInt(number,TYPE,LEN){var sign=0;switch(TYPE){case 1:return number;break;case 2:switch(LEN){case 2:sign=(number&0x80)?1:0;return(number&0x7F)-sign*128;case 4:sign=(number&0x8000)?1:0;return(number&0x7FFF)-sign*32768;case 8:sign=(number&0x80000000)?1:0;return(number&0x7FFFFFFF)-sign*2147483648;case 16:sign=(number&0x8000000000000000)?1:0;return(number&0x7FFFFFFFFFFFFFFF)-sign*9223372036854775808;default:console.error("Type INT LENGTH input failure, number, type, lenght = ",number,TYPE,LEN);return Number.NaN}
default:console.error("Type input failure number, type, lenght = ",number,TYPE,LEN);return Number.NaN}}
function HexToReal(number){var sign=(number&0x80000000);var exponent=(number&0x7F800000)>>23;var mantissa=(number&0x007FFFFF);if(exponent==0x0000){if(mantissa!=0)
return Number.NaN;else return sign?-0.0:+0.0}
else if(exponent==0x00FF){if(mantissa!=0){return Number.NaN}
else{return sign?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY}}
mantissa|=0x00800000;exponent-=127;var float_val=mantissa*Math.pow(2,exponent-23);return sign?-float_val:+float_val}
function HexToLongFloat(longStr){var buffer=new ArrayBuffer(8);var bytes=new Uint8Array(buffer);var doubles=new Float64Array(buffer);for(var x=0;x<8;x++){bytes[7-x]=convAsciiToHex(longStr.substr(x*2,x*2+2),2)}
return doubles[0]}
function HexToDateAndTime(dateAndTimeLong){var year=HexToInt(convAsciiToHex(dateAndTimeLong.substr(0,4),4),1,4);var month=HexToInt(convAsciiToHex(dateAndTimeLong.substr(4,2),2),1,2)-1;var day=HexToInt(convAsciiToHex(dateAndTimeLong.substr(6,2),2),1,2);var hours=HexToInt(convAsciiToHex(dateAndTimeLong.substr(8,2),2),1,2);var minutes=HexToInt(convAsciiToHex(dateAndTimeLong.substr(10,2),2),1,2);var seconds=HexToInt(convAsciiToHex(dateAndTimeLong.substr(12,2),2),1,2);var milliseconds=HexToInt(convAsciiToHex(dateAndTimeLong.substr(14,8),8),1,8)/1000000;var timeStamp=new Date(Date.UTC(year,month,day,hours,minutes,seconds,milliseconds));return timeStamp}
function readWriteToPLC(URL,DATA,ERROR,CALLBACK_OK,CALLBACK_ERROR){$.post(URL,DATA).done(function(returnData){if(CALLBACK_OK!=undefined&&typeof CALLBACK_OK=='function'){var obj=jQuery.parseJSON(returnData.match(/{[^}]*}/gm));if(obj.val!=undefined){var values=convString(obj.val,obj.len,obj.typ,obj.str,ERROR);CALLBACK_OK(values)}
else{CALLBACK_OK(obj)}}}).fail(function(returnData){if(CALLBACK_ERROR!=undefined&&typeof CALLBACK_ERROR=='function'){CALLBACK_ERROR()}
console.error("Error occurred while readWriteToPLC data\n"+ERROR+"\nData:\n"+returnData)})}
function Controller(){var self=this;var _xhrPool=[];var _loadImageID=null;var _loadImage=!0;self.decodeEntities=function(DATA){return htmlDecodeEntities(DATA)}
self.writeData=function(URL,DATA,ERROR,CALLBACK_OK,CALLBACK_ERROR){readWriteToPLC(URL,DATA,ERROR,CALLBACK_OK,CALLBACK_ERROR)}
self.writeForm=function(URL,ID,ERROR,CALLBACK_OK,CALLBACK_ERROR){readWriteToPLC(URL,$(ID).serialize(),ERROR,CALLBACK_OK,CALLBACK_ERROR)}
self.readData=function(URL,ERROR,CALLBACK_OK,CALLBACK_ERROR){readWriteToPLC(URL,'noData',ERROR,CALLBACK_OK,CALLBACK_ERROR)}
self.abortAllAjax=function(){for(i=0;i<_xhrPool.length;i++){_xhrPool[i].abort()}
_xhrPool=[]}
self.initialize=function(plcType,loadImageID){if(initialized){return initializedRetVal}
initialized=!0;if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?':'+window.location.port:'')}
if(!String.trim){String.prototype.trim=function(){return this.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,'')}}
if(!String.prototype.includes)
String.prototype.includes=function(){return String.prototype.indexOf.apply(this,arguments)!==-1};if(window.console==undefined)
window.console={};if(window.console.log==undefined)
window.console.log=function(){};if(window.console.debug==undefined)
window.console.debug=function(){};if(window.console.info==undefined)
window.console.info=function(){};if(window.console.warn==undefined)
window.console.warn=function(){};if(window.console.error==undefined)
window.console.error=function(){};if(window.console.assert==undefined)
window.console.assert=function(){};if(arguments.length>=2){console.info("PLC Type = "+plcType);_plcType=plcType;self._loadImageID=loadImageID}
else{console.error("Missing Parameter @ S7Framework.initialize(plcType, loadImageID)","\n","Initialisation aborted!!!");initializedRetVal=!1}
$.ajaxSetup({mimeType:"text/plain",async:!0,cache:!1},{beforeSend:function(jqXHR){self._xhrPool.push(jqXHR)},complete:function(jqXHR){var index=self._xhrPool.indexOf(jqXHR);if(index>-1){self._xhrPool.splice(index,1)}}});$(self._loadImageID).hide();$(document).ajaxStart(function(){if(self._loadImage)$(self._loadImageID).show()});$(document).ajaxStop(function(){$(self._loadImageID).hide();self._loadImage=!0});initializedRetVal=!0;return initializedRetVal}}
var controller=new Controller();return controller})(jQuery)